---
# tasks file for gce_bastion_host_create
- name: Setup GCP Attributes from service account file
  include_role:
    name: service_account_file_processing

- name: Create Firewall Rule
  include_role:
    name: gce_firewall_create
  vars:
    FIREWALL_NAME: "{{ NAME_INSTANCE_PREFIX }}"

- name: GCE Instance Create | create instances
  include_role:
    name: gce_instance_create
  vars:
    sequence: "{{ start }}"

- name: Configure SSH ProxyCommand
  include_role:
    name: gce_bastion_host_ssh_config
  vars:
    bastion_host_name: "{{ gce_instance_ext_name }}"
    bastion_host_user: "{{ GCLOUD_ACCOUNT_USER }}"
    bastion_host_ip: "{{ gce_instance_ext_IP }}"
    bastion_target_host_range: "{{ NAME_INSTANCE_PREFIX }}*"