---
# tasks file for gcp_resource_manager_folders_create
- name: Assert that ORG_ID is available
  assert:
    that:
    - ORG_ID is defined
    msg: "Please provide ORG_ID collection with list of constraints to no longer enforce."

- name: Assert that the FOLDER_DISPLAY_NAME is available
  assert:
    that:
    - FOLDER_DISPLAY_NAME is defined
    msg: "Please provide the FOLDER_DISPLAY_NAME"

- name: Assert that the GCLOUD_ACCOUNT_EMAIL is available
  assert:
    that:
    - GCLOUD_ACCOUNT_EMAIL is defined
    msg: "Please provide the GCLOUD_ACCOUNT_EMAIL"

#- name: Attempt to create organization folder.
- block:
  - name: Create organization folder
    shell: |
      gcloud beta resource-manager \
      folders create \
      --display-name {{ FOLDER_DISPLAY_NAME }} \
      --organization {{ ORG_ID }} \
      --account {{ GCLOUD_ACCOUNT_ADMIN_EMAIL }}
    register: FOLDER_CREATE_STATUS

#  rescue:
#    debug:
#      msg: "Organization folder {{ FOLDER_DISPLAY_NAME }} exists"
#    when: FOLDER_CREATE_STATUS contains('violates display name uniqueness')

- name: Folder create status output
  debug:
    var: FOLDER_CREATE_STATUS
