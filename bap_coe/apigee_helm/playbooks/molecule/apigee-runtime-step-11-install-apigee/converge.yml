---
- name: Apigee Runtime Install Operator chart
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-operator-mgmt/converge.yml"

- name: Apigee Runtime Install Datastore chart
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-datastore-mgmt/converge.yml"

- name: Apigee Runtime Install Telemetry
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-telemetry-mgmt/converge.yml"

- name: Apigee Runtime Install Redis
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-redis-mgmt/converge.yml"

- name: Apigee Runtime Install Ingress Manager
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-ingress-manager-mgmt/converge.yml"

- name: Apigee Runtime Install Organization
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-org-mgmt/converge.yml"

- name: Apigee Runtime Install Environment
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-env-mgmt/converge.yml"

- name: Apigee Runtime Configure Virtualhost
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-virtualhost-mgmt/converge.yml"

- name: Apigee Runtime Create service to Apigee Ingress
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-ingressgateway-endpoint-expose/converge.yml"

- name: Apigee Runtime Healthcheck on service
  import_playbook: "{{ playbook_dir | dirname }}/_apigee-runtime-ingressgateway-endpoint-healthcheck-withDNS/converge.yml"

- name: Display Apigee hybrid endpoint
  hosts: localhost
  connection: local
  gather_facts: true

  vars_files:
  - ~/.apigee-secure/credentials.yml
  - "{{ playbook_dir | dirname | dirname }}/resources/hybrid-org-host-metadata.yml"
  - "{{ playbook_dir | dirname | dirname }}/resources/hybrid-common-attributes.yml"
  - "{{ playbook_dir | dirname | dirname }}/resources/hybrid-region-{{ DATA_CENTER | default('dc-1') }}.yml"


  collections:
  - bap_coe.apigee_hybrid
  - bap_coe.gcp_management

  task:
  - name: Display Apigee hybrid health endpoint
    debug:
      messag: "https://{{ FQ_DOMAIN_NAME }}/healthz/ingress"