---

- name: Assert credentials folder
  file:
    path: "{{ APIGEE_HYBRID_HELM_CHARTS_DIR }}/{{ chart }}/credentials"
    state: directory
  loop: "{{ APIGEE_HYBRID_CHART_LIST }}"

- name: Distribute service account authorization file to helm chart folders
  copy:
    src: "{{ SERVICE_ACCOUNT_FILE_PATH }}"
    dest: "{{ APIGEE_HYBRID_HELM_CHARTS_DIR }}/{{ chart }}/credentials/{{ SERVICE_ACCOUNT_FILE_PATH | basename }}"
  loop: "{{ APIGEE_HYBRID_CHART_LIST }}"

- name: Assert certs folder
  file:
    path: "{{ APIGEE_HYBRID_HELM_CHARTS_DIR }}/{{ chart }}/certs"
    state: directory
  loop: "{{ APIGEE_HYBRID_CHART_LIST }}"

- name: Distribute tls keys to helm chart folders
  synchronize:
    src: "{{ CERT_FILE_DIR }}"
    dest: "{{ APIGEE_HYBRID_HELM_CHARTS_DIR }}/{{ chart }}/"
  loop: "{{ APIGEE_HYBRID_CHART_LIST }}"

