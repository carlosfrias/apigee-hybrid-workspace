---
- name: Reset cassandra password on Cassandra
  hosts: ds[0]
  tags: ['cache','response-file','copy']
  vars:
    property_folders:
      - "~/.apigee-secure"
      - "~/.apigee"
    opdk_cass_new_password: new_password

  collections:
    - bap_coe.private_cloud

  roles:
    - apigee_opdk_modules
    - apigee_opdk_settings_private_address

  tasks:
    - name: Reset Cassandra password on one node only
      shell: /opt/apigee/apigee-cassandra/bin/cqlsh -u {{ opdk_cass_username }} -u {{ opdk_cass_password }}  {{ private_address }} 9042 -e "ALTER USSER {{ opdk_cass_username }} WITH PASSWORD '{{ opdk_cass_new_password }}'"

- name: Reset cassandra password on Management Server
  hosts: ms,r,mp,rmp,analytics
  tags: ['cache','response-file','copy']
  vars:
    property_folders:
      - "~/.apigee-secure"
      - "~/.apigee"
    opdk_cass_new_password: new_password

  collections:
    - bap_coe.private_cloud

  roles:
    - apigee_opdk_modules
    - apigee_opdk_settings_private_address

  tasks:
    - name: Reset Cassandra password on one node only
      shell: /opt/apigee/apigee-service/bin/apigee-service edge-management-server store_cassandra_credentials -u {{ opdk_cass_username }} -u {{ opdk_cass_new_password }}




