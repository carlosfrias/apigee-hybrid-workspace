---
# tasks file for apigee-opdk-server-registration-state
- name: Assert server_uuid is provided
  assert:
    that:
    - server_uuid is defined
    msg: "Please provide the server_uuid"


#- name: Register server
#  command: curl -u {{ opdk_user_email }}:{{ opdk_user_pass }} http://{{ local_mgmt_ip }}:8080/v1/servers/{{ server_uuid }}
#  register: registered


- name: Register server
  uri:
    url: http://{{ local_mgmt_ip }}:8080/v1/servers/{{ server_uuid }}
    url_username: "{{ opdk_user_email }}"
    url_password: "{{ opdk_user_pass }}"
    body_format: json
    return_content: true
  register: registered

#- name: Obtain server registration report
#  opdk_server_registration_state:
#    server_self: '{{ server_self_info }}'
#    username: '{{ opdk_user_email }}'
#    password: '{{ opdk_user_pass }}'
#    mgmt_server_ip: '{{ local_mgmt_ip }}'
#  when: server_self is defined

#- name: Construct self report variable name
#  set_fact:
#    self_report_name: 'edge_{{ server_type }}_self'

- name: Server Registration State Report
  debug:
    msg: "State of Server Registration: {{ registered.json }}"
#  when: server_self is defined

