---
# tasks file for roles/apigee-hybrid-synchronizer-enable

- name: Setup GCP Attributes from service account file
  include_role:
    name: gcp_token_retrieval

- name: Enable required permission for synchronizer
  uri:
    url: https://apigee.googleapis.com/v1/organizations/{{ PROJECT_ID }}:setSyncAuthorization
    method: POST
    headers: 
      Authorization: Bearer {{ GCLOUD_TOKEN }}
    body_format: json
    status_code: ['200', '409']
    body:
      identities:
        - "serviceAccount:apigee-synchronizer@{{ PROJECT_ID }}.iam.gserviceaccount.com"

