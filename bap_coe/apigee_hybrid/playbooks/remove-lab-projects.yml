- name: Cleanup project that includes the repos
  hosts: localhost

  vars_files:
  - ~/.apigee-secure/apigee-hybrid-sensitive-attributes.yml
  - ./variables/apigee-hybrid-region-single-asm-variables.yml

  vars: 
    PROJECTS:
    - "friasc-hybrid-02112021-2002"
    - "friasc-hybrid-03012021-1450"
    - "friasc-hybrid-03032021-145"
    - "friasc-hybrid-03032021-1533"
    - "friasc-hybrid-03032021-1747"

  collections: bap_coe.apigee_hybrid

  tasks:
    - name: Set CLUSTER_ZONE
      set_fact:
        CLUSTER_ZONE: "{{ REGION }}-b"

    - name: set WORK_DIR to tmp
      set_fact: 
        tmp_work_dir: "{{ playbook_dir + '/workdir' }}"

    - name: Remove projects
      include_role:
        name: apigee-hybrid-project-remove
      vars:
        PROJECT_ID: "{{ item }}"
        WORK_DIR: "{{ tmp_work_dir }}/{{ item }}"
        FQ_CLUSTER_NAME: "gke_{{ item }}_{{ CLUSTER_ZONE }}_{{ CLUSTER_NAME }}"
      with_items: "{{ PROJECTS }}"
