---
- name: Create Apigee runtime on GCP
  hosts: localhost
  connection: local

  vars_files:
    - ~/.apigee-secure/apigee-hybrid-sensitive-attributes.yml
    - "{{ playbook_dir | dirname }}/shared/attributes.yml"

  tasks:
  - name: Remove old WORK_DIR
    file:
      path: "{{ item }}"
      state: absent
    with_items:
    - "{{ WORK_DIR }}"
    - "{{ GITHUB_REPO_DEST }}"

#  pre_tasks:
#    - name: Assert TERRAFORM_PROJECT_PATH
#      stat:
#        path: "{{ TERRAFORM_PROJECT_PATH }}"
#      register: TERRAFORM_PROJECT_PATH_STATUS

#    - name: Terraform destroy
#      ignore_errors: true
#      shell: |
#        {{ TERRAFORM_BIN_PATH }} destroy --var-file={{ TERRAFORM_PROJECT_PATH }}/x-demo.tfvars -var "project_id={{ PROJECT_ID }}" -auto-approve
#      args:
#        chdir: "{{ TERRAFORM_PROJECT_PATH }}"
#      when: TERRAFORM_PROJECT_PATH_STATUS.stat.exists is truthy

#    - name: Remove downloaded terraform modules
#      file:
#        path: ../../terraform-modules
#        state: absent
#      when: TERRAFORM_PROJECT_PATH_STATUS.stat.exists is truthy


