---
- name: Bootstrap pyenv
  hosts: "{{ target_hosts }}"
  gather_facts: no

  tasks:
    - name: Download pyenv
      get_url:
        url: https://pyenv.run
        dest: ~/pyenv.run

    - name: Install pyenv
      command: bash pyenv.run

    - name: Bootstrap workspace
      raw: |
        #!/bin/bash
        export PATH=~/.pyenv/bin:$PATH
        echo "export PATH=~/.pyenv/bin:$PATH" >> ~/.bashrc
        echo "eval '$(pyenv init -)'" >> ~/.bashrc
        echo "eval '$(pyenv virtualenv-init -)'" >> ~/.bashrc
        source ~/.bashrc
        pyenv install {{ python_version | default('3.9.1') }}
