---
- name: Add missing key and value in target file
  lineinfile:
    search_string: '{{ key_value_pair.key }} {{ key_value_pair.separator }} {{ key_value_pair.value }}'
    line: '{{ key_value_pair.key }} {{ key_value_pair.separator }} {{ key_value_pair.value }}'
    path: "{{ key_value_pair.file_name }}"
    state: present
  when: key_value_pair.separator is truthy and key_value_pair.type == "arg"

- name: Update key and value in target file
  replace:
    regexp: "{{ key_value_pair.key }}{{ key_value_pair.separator }}(.*)"
    replace: '{{ key_value_pair.key }}{{ key_value_pair.separator }} {{ key_value_pair.value }}'
    path: "{{ key_value_pair.file_name }}"
  when: key_value_pair.separator is truthy and key_value_pair.type == "arg"

- name: Update key only in target file
  replace:
    regexp: '^(.*){{ key_value_pair.key }}(.*)'
    replace: '\1{{ key_value_pair.value }}\2'
    path: "{{ key_value_pair.file_name }}"
  when: key_value_pair.separator is falsy and key_value_pair.type == "arg"
