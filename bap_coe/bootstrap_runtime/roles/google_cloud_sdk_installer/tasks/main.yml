---
# tasks file for terraform_installer
- name: Update system packages
  apt:
    name: "{{ item }}"
    state: present
  with_items: "{{ system_packages }}"

- block:
  - name: Download repo key
    ansible.builtin.get_url:
      url:  "{{ cloud_google_gpg_key_url }}"
      dest: "{{ cloud_google_gpg_path }}"

  - name: Add repo key
    apt_key:
      url: "{{ cloud_google_repo_url }}"
      state: present

  - name: Add repository
    ansible.builtin.apt_repository:
      repo: "{{ cloud_google_repo_config }}"
      state: present

- name: Install gcloud
  apt:
    name: google-cloud-cli
    state: present
    update_cache: yes


#  RUN echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] http://packages.cloud.google.com/apt cloud-sdk main" | tee -a /etc/apt/sources.list.d/google-cloud-sdk.list && curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | tee /usr/share/keyrings/cloud.google.gpg && apt-get update -y && apt-get install google-cloud-sdk -y


